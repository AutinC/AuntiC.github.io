<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="《程序员的自我修养——链接、装载与库》第四章读书笔记, Huang Shichang&#39;s Blog">
    <meta name="description" content="案例引入本章以如何将a.c文件与b.c文件链接成一个可执行文件来探讨如何进行静态链接a.c文件
extern int shared;int main(){    int a = 100;    swap(&amp;amp;a,&amp;amp;shared">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>《程序员的自我修养——链接、装载与库》第四章读书笔记 | Huang Shichang&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Huang Shichang's Blog" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.jpeg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Huang Shichang&#39;s Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.jpeg" class="logo-img circle responsive-img">
        
        <div class="logo-name">Huang Shichang&#39;s Blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/AutinC/AutinC.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/AutinC/AutinC.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/18.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">《程序员的自我修养——链接、装载与库》第四章读书笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


<!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E3%80%8A%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E2%80%94%E2%80%94%E9%93%BE%E6%8E%A5%E3%80%81%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E3%80%8B/">
                                <span class="chip bg-color">《程序员的自我修养——链接、装载与库》</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-11-28
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.1k
                </div>
                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="案例引入"><a href="#案例引入" class="headerlink" title="案例引入"></a>案例引入</h2><p>本章以如何将a.c文件与b.c文件链接成一个可执行文件来探讨如何进行<strong>静态链接</strong><br><strong>a.c文件</strong></p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="type">int</span> shared;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> a = <span class="number">100</span>;</span><br><span class="line">    swap(&amp;a,&amp;shared);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>


<p>b.c文件</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> shared = <span class="number">1</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>* a, <span class="type">int</span>* b)</span></span><br><span class="line">{</span><br><span class="line">    *a ^= *b ^= *a ^= *b;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>首先将他们编译成目标文件“a.o”和“b.o”</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">$ gcc -c a.c b.c</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>b.c中定义了两个全局符号：变量shared和函数swap()；</li>
<li>a.c中定义了一个全局符号main；</li>
<li>a.c引入了b.c中的shared和swap。</li>
</ul>
<p>接下来把a.o和b.o两个目标文件链接成一个可执行文件ab。</p>
<h2 id="空间和地址分配"><a href="#空间和地址分配" class="headerlink" title="空间和地址分配"></a>空间和地址分配</h2><p>对于多个输入目标文件，链接器如何将它们的各个段合并到一个输出文件？</p>
<p><strong>”链接器为目标文件分配地址和空间“</strong>：这里既指在输出的可执行文件中的空间、也指装载后的虚拟地址的空间。<strong>但对.bss段来说只限于后者。</strong></p>
<h3 id="按序叠加"><a href="#按序叠加" class="headerlink" title="按序叠加"></a>按序叠加</h3><p>直接将各个目标文件依次合并。</p>
<p><img src="https://gcdnb.pbrd.co/images/Mhf63uIyX4Xv.png?o=1" alt="ABC三个目标文件按序叠加"></p>
<p>由于地址和空间对齐的关系，会<strong>造成内存空间大量的碎片</strong>。段的装载地址与空间的对其单位是页（4096字节），如果一个段只有1个字节，也要在内存中占用4096字节。</p>
<h3 id="相似段合并"><a href="#相似段合并" class="headerlink" title="相似段合并"></a>相似段合并</h3><p>相同性质的段合并到一起。</p>
<p><img src="https://gcdnb.pbrd.co/images/vz9apxJBR653.png?o=1"></p>
<p>一般采用<strong>两步链接法</strong>（Two-pass Linking）：</p>
<ol>
<li><p><strong>空间与地址分配</strong><br>扫描所有输入文件，并获得它们各个段的<strong>长度、属性和位置</strong>；将它们符号表中所有的符号定义和符号引用收集起来，统一放到一个<strong>全局符号表</strong>中。</p>
</li>
<li><p><strong>符号解析与重定位</strong></p>
<p>利用上一步获得的信息，读取输入文件中段的数据、重定位信息，并进行<strong>符号解析和重定位</strong>。</p>
<p>使用<strong>ld</strong>链接器，将目标文件链接起来：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ ld a.o b.o -e main -o ab</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>ld链接器默认程序入口是_start，**-e main** 表示将main函数作为程序的入口。</li>
<li><strong>-o ab</strong> 表示链接输出文件名是ab。</li>
</ul>
<p>使用<strong>odjdump -h</strong>命令分别查看a.o/b.o/ab可以发现链接前后地址分配VMA的变化：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">[root@iZ2vcb7xboqe2qhv0easpqZ Chapter4]<span class="comment"># objdump -h a.o</span></span><br><span class="line"></span><br><span class="line">a.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA               LMA               File off  Algn</span><br><span class="line">  0 .text         00000027  0000000000000000  0000000000000000  00000040  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE</span><br><span class="line">  1 .data         00000000  0000000000000000  0000000000000000  00000067  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line">  2 .bss          00000000  0000000000000000  0000000000000000  00000067  2**0</span><br><span class="line">                  ALLOC</span><br><span class="line">  3 .comment      0000002e  0000000000000000  0000000000000000  00000067  2**0</span><br><span class="line">                  CONTENTS, READONLY</span><br><span class="line">  4 .note.GNU-stack 00000000  0000000000000000  0000000000000000  00000095  2**0</span><br><span class="line">                  CONTENTS, READONLY</span><br><span class="line">  5 .eh_frame     00000038  0000000000000000  0000000000000000  00000098  2**3</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA</span><br><span class="line">[root@iZ2vcb7xboqe2qhv0easpqZ Chapter4]<span class="comment"># objdump -h b.o</span></span><br><span class="line"></span><br><span class="line">b.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA               LMA               File off  Algn</span><br><span class="line">  0 .text         0000004a  0000000000000000  0000000000000000  00000040  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, READONLY, CODE</span><br><span class="line">  1 .data         00000004  0000000000000000  0000000000000000  0000008c  2**2</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line">  2 .bss          00000000  0000000000000000  0000000000000000  00000090  2**0</span><br><span class="line">                  ALLOC</span><br><span class="line">  3 .comment      0000002e  0000000000000000  0000000000000000  00000090  2**0</span><br><span class="line">                  CONTENTS, READONLY</span><br><span class="line">  4 .note.GNU-stack 00000000  0000000000000000  0000000000000000  000000be  2**0</span><br><span class="line">                  CONTENTS, READONLY</span><br><span class="line">  5 .eh_frame     00000038  0000000000000000  0000000000000000  000000c0  2**3</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA</span><br><span class="line">[root@iZ2vcb7xboqe2qhv0easpqZ Chapter4]<span class="comment"># objdump -h ab</span></span><br><span class="line"></span><br><span class="line">ab:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line">Idx Name          Size      VMA               LMA               File off  Algn</span><br><span class="line">  0 .text         00000071  00000000004000e8  00000000004000e8  000000e8  2**0</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, READONLY, CODE</span><br><span class="line">  1 .eh_frame     00000058  0000000000400160  0000000000400160  00000160  2**3</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line">  2 .data         00000004  0000000000601000  0000000000601000  00001000  2**2</span><br><span class="line">                  CONTENTS, ALLOC, LOAD, DATA</span><br><span class="line">  3 .comment      0000002d  0000000000000000  0000000000000000  00001004  2**0</span><br></pre></td></tr></tbody></table></figure>

<p>可以看出，链接后.text的长度=两个目标文件中.text的长度之和；</p>
<p><strong>链接前所有的VMA都是0，因为他们还未被分配虚拟地址空间，默认为0。</strong></p>
<p><img src="https://gcdnb.pbrd.co/images/JpsHC5Ri7IKo.png?o=1"></p>
<p><strong>在Linux下，ELF可执行文件默认从地址0x08048000开始分配。</strong></p>
</li>
</ol>
<h3 id="符号地址的确定"><a href="#符号地址的确定" class="headerlink" title="符号地址的确定"></a>符号地址的确定</h3><p>链接器首先根据前面的空间分配方法，对各个段的虚拟地址进行确定。如.text段的起始位置是：0x4000e8，.data段的起始位置是：0x6001b8。然后根据各个符号在段内的偏移，确定其真正的虚拟地址，只需对段的基址加上偏移量即可。</p>
<p><img src="https://gcdnb.pbrd.co/images/Z87aqTb4zYuB.png?o=1"></p>
<h2 id="符号解析与重定位"><a href="#符号解析与重定位" class="headerlink" title="符号解析与重定位"></a>符号解析与重定位</h2><h3 id="重定位"><a href="#重定位" class="headerlink" title="重定位"></a>重定位</h3><p>使用<strong>objdump -d a.o</strong> 查看a.o文件的反汇编结果：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">[root@iZ2vcb7xboqe2qhv0easpqZ Chapter4]<span class="comment"># objdump -d a.o</span></span><br><span class="line">a.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;main&gt;:</span><br><span class="line">   0:   55                      push   %rbp</span><br><span class="line">   1:   48 89 e5                mov    %rsp,%rbp</span><br><span class="line">   4:   48 83 ec 10             sub    <span class="variable">$0x10</span>,%rsp</span><br><span class="line">   8:   c7 45 <span class="built_in">fc</span> 64 00 00 00    movl   <span class="variable">$0x64</span>,-0x4(%rbp)</span><br><span class="line">   f:   48 8d 45 <span class="built_in">fc</span>             lea    -0x4(%rbp),%rax</span><br><span class="line">  13:   be 00 00 00 00          mov    <span class="variable">$0x0</span>,%esi</span><br><span class="line">  18:   48 89 c7                mov    %rax,%rdi</span><br><span class="line">  1b:   b8 00 00 00 00          mov    <span class="variable">$0x0</span>,%eax</span><br><span class="line">  20:   e8 00 00 00 00          callq  25 &lt;main+0x25&gt;</span><br><span class="line">  25:   c9                      leaveq </span><br><span class="line">  26:   c3                      retq  </span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>a.o文件中对shared的引用为偏移为0x13的位置：</strong>be 00 00 00 00<br>它的作用是将shared的地址赋值到<strong>esi寄存器</strong>中，该指令一共5个字节，第1个字节是指令码，后4个字节是shared的地址。由于源码在编译时，编译器不知道shared的地址，因此<strong>把0作为它们的地址</strong>。</li>
<li><strong>a.o文件中对swap的引用为偏移为0x20的位置</strong>：e8 00 00 00 00<br>该指令一共5个字节，前面的0xe8是操作码。根据Intel的IA-32体系软件开发者手册，这是一条<strong>近址相对位移调用指令</strong>。后面4个字节是被调用的函数相对调用指令的下一条指令的偏移量。</li>
</ul>
<p>编译器把这两条指令的地址用“00 00 00 00”代替，把真正的地址计算工作留给了链接器，链接器可以根据符号的地址对每个需要重定位的指令进行修正。</p>
<p>使用<strong>objdump -d ab</strong>命令查看ab的反汇编代码：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">[root@iZ2vcb7xboqe2qhv0easpqZ Chapter4]<span class="comment"># objdump -d ab</span></span><br><span class="line"></span><br><span class="line">ab:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000004000e8 &lt;main&gt;:</span><br><span class="line">  4000e8:       55                      push   %rbp</span><br><span class="line">  4000e9:       48 89 e5                mov    %rsp,%rbp</span><br><span class="line">  4000ec:       48 83 ec 10             sub    <span class="variable">$0x10</span>,%rsp</span><br><span class="line">  4000f0:       c7 45 <span class="built_in">fc</span> 64 00 00 00    movl   <span class="variable">$0x64</span>,-0x4(%rbp)</span><br><span class="line">  4000f7:       48 8d 45 <span class="built_in">fc</span>             lea    -0x4(%rbp),%rax</span><br><span class="line">  4000fb:       be 00 10 60 00          mov    <span class="variable">$0x601000</span>,%esi</span><br><span class="line">  400100:       48 89 c7                mov    %rax,%rdi</span><br><span class="line">  400103:       b8 00 00 00 00          mov    <span class="variable">$0x0</span>,%eax</span><br><span class="line">  400108:       e8 02 00 00 00          callq  40010f &lt;swap&gt;</span><br><span class="line">  40010d:       c9                      leaveq </span><br><span class="line">  40010e:       c3                      retq   </span><br><span class="line"></span><br><span class="line">000000000040010f &lt;swap&gt;:</span><br><span class="line">  40010f:       55                      push   %rbp</span><br><span class="line">  400110:       48 89 e5                mov    %rsp,%rbp</span><br><span class="line">  400113:       48 89 7d f8             mov    %rdi,-0x8(%rbp)</span><br><span class="line">  400117:       48 89 75 f0             mov    %rsi,-0x10(%rbp)</span><br><span class="line">  40011b:       48 8b 45 f8             mov    -0x8(%rbp),%rax</span><br><span class="line">  40011f:       8b 10                   mov    (%rax),%edx</span><br><span class="line">  400121:       48 8b 45 f0             mov    -0x10(%rbp),%rax</span><br><span class="line">  400125:       8b 08                   mov    (%rax),%ecx</span><br><span class="line">  400127:       48 8b 45 f8             mov    -0x8(%rbp),%rax</span><br><span class="line">  40012b:       8b 30                   mov    (%rax),%esi</span><br><span class="line">  40012d:       48 8b 45 f0             mov    -0x10(%rbp),%rax</span><br><span class="line">  400131:       8b 00                   mov    (%rax),%eax</span><br><span class="line">  400133:       31 c6                   xor    %eax,%esi</span><br><span class="line">  400135:       48 8b 45 f8             mov    -0x8(%rbp),%rax</span><br><span class="line">  400139:       89 30                   mov    %esi,(%rax)</span><br><span class="line">  40013b:       48 8b 45 f8             mov    -0x8(%rbp),%rax</span><br><span class="line">  40013f:       8b 00                   mov    (%rax),%eax</span><br><span class="line">  400141:       31 c1                   xor    %eax,%ecx</span><br><span class="line">  400143:       48 8b 45 f0             mov    -0x10(%rbp),%rax</span><br><span class="line">  400147:       89 08                   mov    %ecx,(%rax)</span><br><span class="line">  400149:       48 8b 45 f0             mov    -0x10(%rbp),%rax</span><br><span class="line">  40014d:       8b 00                   mov    (%rax),%eax</span><br><span class="line">  40014f:       31 c2                   xor    %eax,%edx</span><br><span class="line">  400151:       48 8b 45 f8             mov    -0x8(%rbp),%rax</span><br><span class="line">  400155:       89 10                   mov    %edx,(%rax)</span><br><span class="line">  400157:       5d                      pop    %rbp</span><br><span class="line">  400158:       c3                      retq  </span><br></pre></td></tr></tbody></table></figure>

<p>​	发现shared的地址变为0x6001b8，而swap函数的地址为0x40010d+0x7 = 0x400114。</p>
<h3 id="重定位表"><a href="#重定位表" class="headerlink" title="重定位表"></a>重定位表</h3><p>重定位表用来保存与重定位相关的信息。<strong>每个要被重定位的ELF段都有一个重定位表</strong>。一个重定位表往往是ELF文件中的一个段。如代码段“.text”有要被重定位的地方，那么就有’.ref.text’的段保存了代码段的重定位表。</p>
<p>使用<strong>objdump -r a.o</strong> 查看a.o文件的重定位表：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">[root@iZ2vcb7xboqe2qhv0easpqZ Chapter4]<span class="comment"># objdump -r a.o</span></span><br><span class="line"></span><br><span class="line">a.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">RELOCATION RECORDS FOR [.text]:</span><br><span class="line">OFFSET           TYPE              VALUE </span><br><span class="line">0000000000000014 R_X86_64_32       shared</span><br><span class="line">0000000000000021 R_X86_64_PC32     swap-0x0000000000000004</span><br><span class="line"></span><br><span class="line">RELOCATION RECORDS FOR [.eh_frame]:</span><br><span class="line">OFFSET           TYPE              VALUE </span><br><span class="line">0000000000000020 R_X86_64_PC32     .text</span><br></pre></td></tr></tbody></table></figure>

<p>每个要被重定位的地方叫一个<strong>重定位入口</strong>。重定位入口的偏移表示该入口在要被重定位段中的位置。根据前面的反汇编结果，这里的0x14和0x21分别是代码段中shared和swap的地址所在的位置。</p>
<p>对于32位的Intel x86系列处理器来说，重定位表是一个<strong>Elf32_Rel</strong>结构的数组，每个数组元素对应一个重定位入口。</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">Elf32_Addr r_offset; <span class="comment">//重定位入口的偏移。</span></span><br><span class="line">Elf32_Word r_info; <span class="comment">//重定位入口的类型和符号。</span></span><br><span class="line">}Elf32_Rel;</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>r_offset：对可重定位文件来说，是该重定位入口所要修正的位置的第一个字节相对于段起始地偏移。</li>
<li>r_info：低8位表示重定位入口的类型；高24位表示重定位入口的符号在符号表中的下标。</li>
</ul>
<h3 id="符号解析"><a href="#符号解析" class="headerlink" title="符号解析"></a>符号解析</h3><p>使用<strong>readelf -s a.o</strong>查看a.o的符号表：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">[root@iZ2vcb7xboqe2qhv0easpqZ Chapter4]<span class="comment"># readelf -s a.o</span></span><br><span class="line"></span><br><span class="line">Symbol table <span class="string">'.symtab'</span> contains 11 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS a.c</span><br><span class="line">     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1 </span><br><span class="line">     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    3 </span><br><span class="line">     4: 0000000000000000     0 SECTION LOCAL  DEFAULT    4 </span><br><span class="line">     5: 0000000000000000     0 SECTION LOCAL  DEFAULT    6 </span><br><span class="line">     6: 0000000000000000     0 SECTION LOCAL  DEFAULT    7 </span><br><span class="line">     7: 0000000000000000     0 SECTION LOCAL  DEFAULT    5 </span><br><span class="line">     8: 0000000000000000    39 FUNC    GLOBAL DEFAULT    1 main</span><br><span class="line">     9: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND shared</span><br><span class="line">    10: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND swap</span><br></pre></td></tr></tbody></table></figure>

<p>每个重定位的入口都是对一个符号的引用，链接器会去查找所有输入目标文件的符号表组成的全局符号表，找到相应的符号后进行重定位。</p>
<p>“shared”和“swap”类型都是UND类型，这种未定义符号都是因为该目标文件中有关于它们的重定位项，链接器在扫描完所有输入目标文件后，所有的这些未定义符号应该能在全局符号表中找到，否则链接器报符号未定义错误。</p>
<h3 id="指令修正方式"><a href="#指令修正方式" class="headerlink" title="指令修正方式"></a>指令修正方式</h3><p>不同处理器指令对地址的格式和方式都不一样。寻址方式有多种，如：</p>
<ul>
<li>近址寻址或远址寻址；</li>
<li>绝对寻址或相对寻址；</li>
<li>寻址长度有8、16、32、64位等区别。</li>
</ul>
<p>但对于32位x86平台的ELF文件的重定位入口所修正的指令寻址方式，只有两种；</p>
<ul>
<li>绝对近址32位寻址；</li>
<li>相对近址32位寻址。</li>
</ul>
<p>重定位入口的r_info成员低8位表示重定位入口类型，如表所示：</p>
<p><img src="https://gcdnb.pbrd.co/images/D3E8tdIs7e2g.png?o=1"></p>
<p>其中，A=保存在被修正位置的值；P=被修正的位置（相对于段开始的偏移量或虚拟地址，可以通过r_offset计算得到）；S=符号的实际地址（r_info的高24位）</p>
<p><strong>绝对寻址修正后的地址为该符号的实际地址，相对寻址修正后的地址为符号距离被修正位置的地址差。</strong></p>
<h2 id="COMMON块"><a href="#COMMON块" class="headerlink" title="COMMON块"></a>COMMON块</h2><p>由于弱符号机制允许同一个符号的定义存在多个文件中。但是如果一个弱符号定义在多个目标文件中，它们的类型又不同。而连接器本身并不支持符号的类型辨别，那么链接器该如何处理呢？</p>
<p>考虑到三种情况：<br>（1）两个或两个以上强符号不一致；<br>（2）有一个强符号，其他都是弱符号，出现类型不一致；<br>（3）两个或两个以上弱符号类型不一致；</p>
<p>对于第（1）中情况，无须额外处理，链接器会报符号多重定义错误；链接器处理的是后两种情况。</p>
<p>事实上，现在的编译器和链接器支持一种叫做<strong>COMMON块</strong>的机制。当不同的目标文件需要的COMMON块空间大小不一致时，以最大的那块为准。COMMON类型的链接规则是针对符号都是弱符号的情况。</p>
<p>如果其中有一个符号是强符号，则<strong>输出结果中符号所占空间与强符号相同</strong>。如果链接过程又弱符号大小大于强符号，那么ld链接器会报错。</p>
<p><em>问题：为什么编译器不直接把未初始化的全局变量也当作未初始化的局部静态变量一样处理，在.bss段为其分配空间，而是将其标记为一个COMMON类型的变量？</em></p>
<p><em>回答：当编译器将一个编译单元编译成目标文件时，如果包含弱符号，则其所占空间是未知的，因为有可能在链接到其他文件中也定义了该弱符号，而弱符号以占用空间大的为准，因此无法确定在.bss段为其分配多少空间。而链接时，则大小就能确定了，所以它可以在最终输出文件的.bss段为其分配空间。所以总体来看，<strong>未初始化全局变量还是放在.bss段的</strong>。</em></p>
<p>GCC的“**-fno-common<strong>”允许把未初始化的全局变量不以COMMON块的形式处理，或者使用“</strong>attribute**”扩展：</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> global __attribute__((nocommon));</span><br></pre></td></tr></tbody></table></figure>

<p>一旦一个未初始化的全局变量不以COMMON块的形式存在，它就相当于一个<strong>强符号</strong>。如果其他目标文件中还有一个变量的强符号定义，链接时就会发生符号重复定义错误。</p>
<h2 id="C-相关问题"><a href="#C-相关问题" class="headerlink" title="C++相关问题"></a>C++相关问题</h2><h3 id="重复代码消除"><a href="#重复代码消除" class="headerlink" title="重复代码消除"></a>重复代码消除</h3><p>C++的语言特性导致它可能会产生大量的重复代码，如模板、虚函数表等。</p>
<p>以模板为例，一种有效的消除重复代码的手段是：将每个模板的实例代码都<strong>单独地存放在一个段里</strong>，每个段只包含一个模板实例。当不同的编译单元以相同的类型实例化该模板后，也会生成同样的名字，进而链接的时候可以辨别出这些相同的模板实例段，然后进行合并，丢弃重复的段。</p>
<p>GCC把这种段叫做“.gnu.linkonce.name”，VISUAL C++把这种段叫做“COMDAT”。</p>
<p><strong>函数级别链接:</strong></p>
<p> 通常的链接过程都是<strong>文件或者编译单元</strong>级别的链接，但是当只需要使用某个目标为见中的一个函数或变量的时候，就需要全部包含该文件，导致体积很大，编译器为此专门提供了函数级别的链接，与重复代码消除和相似，编译器<strong>将所有函数都像模板函数一样单独保存到一个段中</strong>，需要的时候再将其包含到输出文件，其他的则直接抛弃，这虽然可以产生较小的最终文件的体积，但是由于段的数目增减，减慢了编译和链接的过程。</p>
<p>GCC使用**-fdata-sections<strong>和</strong>-ffunction-sections**可以将变量或者函数分别保存到独立的段中。</p>
<h3 id="全局构造与析构"><a href="#全局构造与析构" class="headerlink" title="全局构造与析构"></a>全局构造与析构</h3><p>全局对象的构造在main函数之前执行，全局对象的析构在main函数之后执行。</p>
<p>Linux下的入口函数是**_star**t，用于在main执行前进行初始化，在main之后执行清理工作。</p>
<p>ELF文件定义了两种特殊的段：</p>
<ul>
<li>.init：该段里面保存的是可执行指令，它构成了进程的初始化代码。当一个程序开始运行时，在main函数被调用之前，Glibc的初始化部分安排执行这个段的中的代码。</li>
<li>.fini：该段保存着进程终止代码指令。当一个程序的main函数正常退出时，Glibc会安排执行这个段中的代码。<br>可以借助这两个特殊段实现C++的全局构造和析构函数。</li>
</ul>
<h3 id="C-与ABI"><a href="#C-与ABI" class="headerlink" title="C++与ABI"></a>C++与ABI</h3><p>两个编译器编译出来的目标文件能够相互连接需要满足这些条件：采用同样的目标文件格式、拥有同样的符号修饰标准、变量的内存分布方式相同、函数的调用方式相同。这些规范统称为<strong>ABI</strong>（Application Binary Interface）</p>
<p>影响ABI的因素很多，对于<strong>C语言</strong>的目标代码来说，有这几个方面：</p>
<ul>
<li>内置类型的大小和在存储器中的放置方式</li>
<li>组合类型的存储方式和内存方式</li>
<li>外部符号与用户定义的符号之间的命名方式和解析方式</li>
<li>函数调用方式</li>
<li>堆栈的分布方式</li>
<li>寄存器使用约定</li>
</ul>
<p>对于C++来说，更加复杂，需要考虑：</p>
<ul>
<li>继承体系的内存分布</li>
<li>指向成员函数的指针的内存分布，如何通过指向成员函数的指针来调用成员函数，如果传递this指针</li>
<li>如何调用虚函数，vtable的内容和分布形式，vtable指针在object中的位置等</li>
<li>template如何实例化</li>
<li>外部符号的修饰</li>
<li>全局对象的修饰</li>
<li>全局对象的构造与析构</li>
<li>异常的产生和捕获机制</li>
<li>标准库的细节问题，RTTI如何实现</li>
<li>内嵌函数访问细节</li>
</ul>
<h2 id="静态库链接"><a href="#静态库链接" class="headerlink" title="静态库链接"></a>静态库链接</h2><p>程序如何使用操作系统提供的API。在一般情况下，一种语言的开发环境往往会附带语言库。这些库就是对操作系统API的包装。比如printf，就是对write系统调用的封装。库里面还有一些很常用的函数。一个静态库可以简单看成是一组目标文件的集合，即很多目标文件经过压缩打包后形成的一个文件。</p>
<p>glibc由很多源文件组成的，编译完后的目标文件，经过<strong>ar</strong>压缩程序压缩到一起，并且对其编号索引，便于查找和检索，然后就形成了libc.a这个静态库。</p>
<p>linux下使用<strong>ar -t xx.a</strong>可以查看.a文件中包含的.o文件。在windows平台下可以使用<strong>lib /LIST xx.lib</strong>查看。</p>
<p>使用<strong>objdump -t xx.a | grep xxx</strong>查找特定的目标文件。</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ar -x libc.a		// 解压</span><br><span class="line">ld hello.o printf.o	// 链接两个目标文件</span><br></pre></td></tr></tbody></table></figure>

<p>以上代码会报错，因为printf.o中依赖其他目标文件，系统库之间相互交织，相互调用。就算将hello.o和整个libc.a链接，也不一定能形成可执行文件，因为还需要一些其他辅助性质的目标文件和库，具体过程可以通过<strong>gcc -static –verbose -fno-builtin hello.c</strong>将编译链接过程的中间步骤打印出来， 即使写的代码非常简单，这也是一个非常长的依赖关系。</p>
<h2 id="链接过程控制"><a href="#链接过程控制" class="headerlink" title="链接过程控制"></a>链接过程控制</h2><p>链接器一般都提供多种控制整个链接过程的方法，以用来产生用户所需要的文件。一般链接器有以下三种方法：</p>
<ul>
<li>ld命令行指定参数</li>
<li>目标文件中放置指令</li>
<li>链接控制脚本</li>
</ul>
<h3 id="链接控制脚本"><a href="#链接控制脚本" class="headerlink" title="链接控制脚本"></a>链接控制脚本</h3><p>visual C++把这样的控制脚本叫做模板定义文件，扩展名为**.def**</p>
<p>linux下通过<strong>ld -verbose</strong>查看默认的链接脚本。存放在/usr/lib/ldscripts/下。</p>
<p>使用-T来指定一个链接脚本：</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ld -T link.script</span><br></pre></td></tr></tbody></table></figure>

<h3 id="最小程序演示链接"><a href="#最小程序演示链接" class="headerlink" title="最小程序演示链接"></a>最小程序演示链接</h3><p><img src="https://gcdnb.pbrd.co/images/ZL8LIwmM1Equ.png?o=1" alt="使用GCC内嵌汇编的Helloworld程序"></p>
<ul>
<li>先使用下面方式以普通命令方式编译和链接：</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">gcc -c -fno-builtin tinyhelloworld.c</span><br><span class="line">ld -static -e nomain -o tinyhelloworld tinyhelloworld.o</span><br></pre></td></tr></tbody></table></figure>

<p>​	-fno-builtin：关闭GCC内置函数功能，防止将printf函数替换为puts、exit函数替换成内置</p>
<p>​	-static：使用静态链接的方式链接</p>
<p>​	-e nomain：表示程序的入口函数为nomain，本质是把ELF文件头Elf32_Ehdr的e_entry参数赋值为nomain函数地址</p>
<p>​	通过这种方式会发现可执行ELF文件有四个段：.text、.rodata、.data、.comment。</p>
<ul>
<li><p>使用ld链接脚本</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">ENTRY(nomain)							// 指定程序的入口为nomain函数</span><br><span class="line"></span><br><span class="line">SECTIONS</span><br><span class="line">{</span><br><span class="line">	. = 0x08048000 + SIZEOF_HEADERS;	// 设置当前虚拟地址</span><br><span class="line">	tinytext : { *(.text) *(.data) *(.rodata) }	// 将所有输入文件中的.text、.data、.rodata段合并到输出文件的tinytext段</span><br><span class="line">	/DISCARD/ : { *(.comment) }			// 丢弃所有输入文件中的.comment段，不保存到输出文件中</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>TinyHelloword可执行文件中除了tinytext段，还有.shstrtab、.symtabhe 、.strtab段，分别是<strong>段名字符串表（必不可少）、符号表（可以通过-s参数或strip命令去除）、字符串表</strong>。</p>
</li>
</ul>
<h3 id="ld链接脚本语法简介"><a href="#ld链接脚本语法简介" class="headerlink" title="ld链接脚本语法简介"></a>ld链接脚本语法简介</h3><ul>
<li><p>常用命令语句</p>
<p><img src="https://gcdnb.pbrd.co/images/i3zYnEIiw7Gw.png?o=1"></p>
<p><img src="https://gcdnb.pbrd.co/images/CTIWQK1PKEDc.png?o=1"></p>
</li>
</ul>
<h2 id="BFD库"><a href="#BFD库" class="headerlink" title="BFD库"></a>BFD库</h2><p><strong>BFD（binary file description library）</strong>是binutils项目的一个子项目，希望通过一种统一的接口来处理不同的目标文件格式。</p>
<p><strong>BFD库把目标文件抽象成一个同一的模型，程序只要通过操纵抽象目标文件模型就可以实现操作所有BFD支持的目标文件格式。</strong></p>
<p>现在gcc（gnu汇编器GAS GNU assembler）链接器ld 调试器GDB及binutils的其他工具都是通过BFD库来处理文件，而不是直接操作目标文件。这样做最大的好处是将编译器和链接器本身同具体的目标文件格式隔离开来。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">AutinC</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://autinc.github.io/2023/11/28/cheng-xu-yuan-de-zi-wo-xiu-yang-lian-jie-zhuang-zai-yu-ku-di-si-zhang-du-shu-bi-ji/">https://autinc.github.io/2023/11/28/cheng-xu-yuan-de-zi-wo-xiu-yang-lian-jie-zhuang-zai-yu-ku-di-si-zhang-du-shu-bi-ji/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">AutinC</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E3%80%8A%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E2%80%94%E2%80%94%E9%93%BE%E6%8E%A5%E3%80%81%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E3%80%8B/">
                                    <span class="chip bg-color">《程序员的自我修养——链接、装载与库》</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="https://unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'v0LOxueiWIPRw9lXbmg2YToy-gzGzoHsz',
        appKey: 'RhYvmeHaBq8MHqMgnwdQbvm8',
        serverURLs: 'https://v0loxuei.lc-cn-n1-shared.com',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'false' === 'true',
        avatar: 'mp',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '留下您的观点看法，共同讨论吧！'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/11/29/css-cai-niao-jiao-cheng/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="CSS 菜鸟教程">
                        
                        <span class="card-title">CSS 菜鸟教程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-11-29
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            AutinC
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97/">
                        <span class="chip bg-color">前端三件套</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/11/22/cheng-xu-yuan-de-zi-wo-xiu-yang-lian-jie-zhuang-zai-yu-ku-di-san-zhang-du-shu-bi-ji/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="《程序员的自我修养——链接、装载与库》第三章读书笔记">
                        
                        <span class="card-title">《程序员的自我修养——链接、装载与库》第三章读书笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-11-22
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            AutinC
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E3%80%8A%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E2%80%94%E2%80%94%E9%93%BE%E6%8E%A5%E3%80%81%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93%E3%80%8B/">
                        <span class="chip bg-color">《程序员的自我修养——链接、装载与库》</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Huang Shichang&#39;s Blog<br />'
            + '文章作者: AutinC<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2024</span>
            
            <a href="/about" target="_blank">AutinC</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">309.9k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Autinc" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:h1743551466@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我： h1743551466@126.com" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1743551466" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1743551466" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>






</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    
        <script src="//code.tidio.co/9r5hwp19xkh9jgnm8ualt74ktcqj9hkg.js"></script>
        <script>
            $(document).ready(function () {
                setInterval(change_Tidio, 50);
                function change_Tidio() {
                    var tidio=$("#tidio-chat iframe");
                    if(tidio.css("display")=="block"&& $(window).width()>977 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" &&$(window).width()>977)>0? "-40px" : ($("div.toc-title").length&&$(window).width()>977)>0?"85px":"20px";
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.height=parseInt(tidio.css("height"))>=520?"520px":tidio.css("height");
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()>601 &&$(window).width()<992 ){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && 601< $(window).width()<992)>0? "-40px":"20px" ;
                        document.getElementById("tidio-chat-iframe").style.right="-15px";
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    else if(tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))<230){
                        document.getElementById("tidio-chat-iframe").style.bottom= ($("div#backTop.top-scroll").css("display")=="none" && $(window).width()<601)>0? "-10px":"45px" ;
                        document.getElementById("tidio-chat-iframe").style.zIndex="997";
                    }
                    if( tidio.css("display")=="block"&&$(window).width()<601 && parseInt(tidio.css("height"))>=230){
                        document.getElementById("tidio-chat-iframe").style.zIndex="998";
                    }
                }
            });
        </script>
    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</body>

</html>
